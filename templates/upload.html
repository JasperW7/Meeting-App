{% extends "base.html" %}

{% block title %}Upload Notes - Note App{% endblock %}

{% block content %}
  <h1>Upload MP4 or MP3 for Transcription</h1>
  <input type="file" id="video-upload" accept="video/mp4,audio/mp3" />
  <button id="upload-btn">Upload & Transcribe</button>
  <div id="result">üìÅ Waiting for upload...</div>

  <script>
    const uploadInput = document.getElementById("video-upload");
    const uploadBtn = document.getElementById("upload-btn");
    const resultDiv = document.getElementById("result");

    uploadBtn.addEventListener("click", () => {
      const file = uploadInput.files[0];
      if (!file) {
        resultDiv.innerHTML = "‚ùå Please select a .mp4 or .mp3 file first.";
        return;
      }

      const formData = new FormData();
      formData.append("video", file);

      resultDiv.innerHTML = "‚è≥ Uploading and processing...";

      fetch("/upload/", {
        method: "POST",
        body: formData,
      })
      .then(async response => {
        const text = await response.text();
        if (!response.ok) throw new Error("Server error: " + response.status + " ‚Äì " + text);
        return JSON.parse(text);
      })
      .then(data => {
        resultDiv.innerHTML = `
          <p><strong>Transcription:</strong> ${data.text}</p>
          <p><strong>Summary:</strong> ${data.summary}</p>
        `;
      })
      .catch(error => {
        console.error("Error during upload/transcription:", error);
        resultDiv.innerHTML = `<p>Error: ${error.message}</p>`;
      });
    });
  </script>
{% endblock %}
